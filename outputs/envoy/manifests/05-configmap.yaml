---
apiVersion: v1
kind: ConfigMap
metadata:
  name: tailscale-egress-envoy
data:
  envoy.yaml: |
    "static_resources":
      "clusters":
      - "connect_timeout": "5s"
        "load_assignment":
          "cluster_name": "cluster_tail40b056_0"
          "endpoints":
          - "lb_endpoints":
            - "endpoint":
                "address":
                  "socket_address":
                    "address": "127.0.0.1"
                    "port_value": 10550
        "name": "cluster_tail40b056_0"
        "typed_extension_protocol_options":
          "envoy.extensions.upstreams.http.v3.HttpProtocolOptions":
            "@type": "type.googleapis.com/envoy.extensions.upstreams.http.v3.HttpProtocolOptions"
            "explicit_http_config":
              "http_protocol_options": {}
      - "connect_timeout": "5s"
        "load_assignment":
          "cluster_name": "cluster_tail88356_0"
          "endpoints":
          - "lb_endpoints":
            - "endpoint":
                "address":
                  "socket_address":
                    "address": "127.0.0.1"
                    "port_value": 10551
        "name": "cluster_tail88356_0"
        "typed_extension_protocol_options":
          "envoy.extensions.upstreams.http.v3.HttpProtocolOptions":
            "@type": "type.googleapis.com/envoy.extensions.upstreams.http.v3.HttpProtocolOptions"
            "explicit_http_config":
              "http_protocol_options": {}
      "listeners":
      - "address":
          "socket_address":
            "address": "0.0.0.0"
            "port_value": 10000
            "protocol": "TCP"
        "filter_chains":
        - "filters":
          - "name": "tcp"
            "typed_config":
              "@type": "type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy"
              "cluster": "cluster_tail40b056_0"
              "stat_prefix": "tcp_stats_tail40b056_0"
              "tunneling_config":
                "hostname": "openspeedtest:3000"
        "name": "listener-tail40b056-0"
      - "address":
          "socket_address":
            "address": "0.0.0.0"
            "port_value": 11000
            "protocol": "TCP"
        "filter_chains":
        - "filters":
          - "name": "tcp"
            "typed_config":
              "@type": "type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy"
              "cluster": "cluster_tail88356_0"
              "stat_prefix": "tcp_stats_tail88356_0"
              "tunneling_config":
                "hostname": "openspeedtest:3000"
        "name": "listener-tail88356-0"
    